<div class="admin container">
  <h1 class="col-md-12 text-center">Manage Works</h1>
  <div class="col-md-3">
    <h2>Add Work</h2>
    <form name="worksForm" ng-submit="addWork(worksForm.$valid)" novalidate>
      <div class="form-group" ng-class="{ 'has-success' : worksForm.title.$valid && worksForm.title.$touched, 'has-error' : worksForm.title.$touched && worksForm.title.$invalid }">
        <label class="control-label">Title</label>
        <div class="input-group">
          <input type="text" name="title" class="form-control" ng-model="newTitle" placeholder="Symphony No.10" required ng-maxlength="80">
          <span class="input-group-addon">
            <span class="fa fa-fw form-control-feedback" ng-class="{ 'fa-check' : worksForm.title.$valid && worksForm.title.$touched, 'fa-times' : worksForm.title.$invalid && worksForm.title.$touched }" aria-hidden="true"></span>
          </span>
        </div>
        <span class="sr-only">(success)</span>
        <div class="help-block" ng-messages="worksForm.title.$error" ng-if="worksForm.title.$touched">
          <p ng-message="required">A title is required.</p>
          <p ng-message="maxlength">The title must be under 80 characters long.</p>
        </div>
      </div>
      <div class="form-group" ng-class="{ 'has-success' : worksForm.category.$valid && worksForm.category.$touched, 'has-error' : worksForm.category.$touched && worksForm.category.$invalid }">
        <label class="control-label">Category of the Work</label>
        <div class="input-group">
          <select ng-model="newCategory" name="category" class="selectpicker form-control" ng-options="g as g for g in groups" required></select>
          <span class="input-group-addon">
            <span class="fa fa-fw form-control-feedback" ng-class="{ 'fa-check' : worksForm.category.$valid && worksForm.category.$touched, 'fa-times' : worksForm.category.$invalid && worksForm.category.$touched }" aria-hidden="true"></span>
          </span>
        </div>
        <span class="sr-only">(success)</span>
        <div class="help-block" ng-messages="worksForm.category.$error" ng-if="worksForm.category.$touched">
          <p ng-message="required">You must choose a category</p>
        </div>
      </div>
      <label><i class="fa fa-asterisk"></i>Year of the Work</label>
      <p class="input-group" ng-class="{ 'has-error' : worksForm.date.$invalid && !worksForm.date.$pristine }">
        <input type="number" name="date" class="form-control" ng-model="newDate" ng-init="newDate = currentYear" required>
        <p ng-show="worksForm.date.$invalid && !worksForm.date.$pristine" class="help-block">You must enter a year</p>
      </p>
      <label>Instrumentation of the Work</label>
      <p class="input-group">
        <input type="text" class="form-control" placeholder="Instrumentation" ng-model="newInstrumentation">
      </p>
      <label>Information</label>
      <p class="input-group">
        <input type="text" class="form-control" placeholder="Work Info" ng-model="newInfo">
      </p>
      <label>Link to Score</label>
      <p class="input-group">
        <input type="url" class="form-control" placeholder="Link to Score" ng-model="newLink">
      </p>
      <label>Link to Audio</label>
      <p class="input-group">
        <input type="url" name="audio" class="form-control" placeholder="Link to Audio" ng-model="newAudio">
      </p>
      <label>Link to Video</label>
      <p class="input-group">
        <input type="url" class="form-control" placeholder="Link to Video" ng-model="newVideo">
      </p>
      <button type="submit" class="btn btn-primary btn-block" ng-disabled="worksForm.$invalid || worksTracks.indexOf(newAudio) !== -1">Add New</button>
    </form>
  </div>

  <accordion class="col-md-9">
    <accordion-group ng-init="status.open = $first" is-open="status.open" ng-repeat="(category, works) in works | groupBy: 'category'">
      <accordion-heading>
        <div>
          {{ category }} <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': status.open, 'glyphicon-chevron-right': !status.open}"></i>
        </div>
      </accordion-heading>
      <div class="admin-works" ng-repeat="work in works | orderBy: 'date':true">
        <div>
          <h3>
            <a href="#" editable-text="work.title" onaftersave="updateWork(work)">
              {{ work.title || "empty" }}
            </a>
            <button type="button" class="btn btn-danger btn-xs" ng-click="confirmDelete(work.title, work)"><i class="fa fa-times"></i></button>
          </h3>
        </div>
        <label>Category</label>
        <div>
          <a href="#" editable-select="work.category" e-ng-options="g as g for g in groups" onaftersave="updateWork(work)">
            {{ work.category || "empty" }}
          </a>
        </div>
        <label>Date</label>
        <div>
          <a href="#" editable-number="work.date" onaftersave="updateWork(work)">
            {{ work.date || "empty" }}
          </a>
        </div>
        <label>Instrumentation</label>
        <div>
          <a href="#" editable-text="work.instrumentation" onaftersave="updateWork(work)">
            {{ work.instrumentation || "empty" }}
          </a>
        </div>
        <label>Info</label>
        <div>
          <a href="#" editable-textarea="work.info" e-rows="7" e-cols="40" ng-bind-html="work.info || 'empty'" onaftersave="updateWork(work)">
            {{ work.info || "empty" }}
          </a>
        </div>
        <label>Link</label>
        <div>
          <a href="#" editable-text="work.link" onaftersave="updateWork(work)">
            {{ work.link || "empty" }}
          </a>
        </div>
        <label>Audio</label>
        <div>
          <a href="#" editable-text="work.audio" onshow="cacheWork(work)" onbeforesave="checkUrl($data)" onaftersave="updateWork(work)">
            {{ work.audio || "empty" }}
          </a>
          <button type="button" class="btn btn-danger btn-xs" ng-if="work.audio" ng-click="clearWorkTrack(work)">remove</button>
        </div>
        <label>Video</label>
        <div>
          <a href="#" editable-text="work.video" onaftersave="updateWork(work)">
            {{ work.video || "empty" }}
          </a>
        </div>
        <hr>
      </div>
    </accordion-group>
  </accordion>
</div>
